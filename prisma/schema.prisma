generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int    @id @default(autoincrement())
  username String @unique

  firstName  String?
  lastName   String?
  middleName String?

  password    String
  phoneNumber String?

  isActive          Boolean @default(true)
  canChangePassword Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  roleId Int?
  role   Role? @relation(fields: [roleId], references: [id])

  companyId Int?
  company   Company? @relation(fields: [companyId], references: [id])

  student Student?
  teacher Teacher?
}

model Company {
  id Int @id @default(autoincrement())

  name        String  @unique
  code        String?
  description String?

  email   String?
  phone   String?
  address String?

  isActive Boolean @default(true)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  users User[]
}

model Role {
  id       Int     @id @default(autoincrement())
  code     String  @unique
  isActive Boolean @default(true)
  isPublic Boolean @default(true)

  permissions Permission[] @relation("RolePermissions")

  users        User[]
  translations RoleTranslation[]
}

model RoleTranslation {
  id   Int    @id @default(autoincrement())
  lang String
  name String

  roleId Int
  role   Role @relation(fields: [roleId], references: [id])

  @@unique([roleId, lang])
}

model Permission {
  id       Int          @id @default(autoincrement())
  code     String       @unique
  parentId Int?
  parent   Permission?  @relation("PermissionTree", fields: [parentId], references: [id])
  children Permission[] @relation("PermissionTree")

  roles Role[] @relation("RolePermissions")

  translations PermissionTranslation[]
}

model PermissionTranslation {
  id   Int    @id @default(autoincrement())
  lang String
  name String

  permissionId Int
  permission   Permission @relation(fields: [permissionId], references: [id])

  @@unique([permissionId, lang])
}

model Group {
  id        Int        @id @default(autoincrement())
  name      String
  code      String   @unique

  description String?
  level       String?
  startDate   DateTime?
  endDate     DateTime?
  isActive  Boolean @default(true)


  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  subjectId Int
  subject   Subject @relation(fields: [subjectId], references: [id])

  teachers  Teacher[]
  students  Student[]
  schedules Schedule[] @relation("GroupSchedules")
}

model Schedule {
  id        Int      @id @default(autoincrement())
  day       WeekDays
  startTime DateTime
  endTime   DateTime

  groupId Int
  group   Group @relation("GroupSchedules", fields: [groupId], references: [id])
}

enum WeekDays {
  monday
  tuesday
  wednesday
  thursday
  friday
  saturday
  sunday
}

model Teacher {
  id         Int      @id
  experience String?
  bio        String?
  photo      String?
  subjects   String[]

  user      User       @relation(fields: [id], references: [id])\
  groups    Group[]
}

model Subject {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  code        String   @unique
  description String?
  isActive  Boolean @default(true)
  groups    Group[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Student {
  id    Int     @id
  bio   String?
  hobby String?
  photo String?

  user      User       @relation(fields: [id], references: [id])
  parents   Parent[]
  groups    Group[]
}

model Parent {
  id    Int        @id @default(autoincrement())
  name  String
  phone String
  type  ParentType

  studentId Int
  student   Student @relation(fields: [studentId], references: [id])
}

enum ParentType {
  father
  mother
  guardian
}
