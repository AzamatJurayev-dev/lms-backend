enum ChatRoomType {
  PRIVATE
  GROUP
}

model ChatRoom {
  id Int @id @default(autoincrement())

  companyId Int?
  company   Company? @relation(fields: [companyId], references: [id])

  type ChatRoomType
  name String?

  groupId Int?
  group   Group? @relation(fields: [groupId], references: [id])

  createdById Int
  createdBy   User @relation("ChatRoomCreatedBy", fields: [createdById], references: [id])

  participants ChatParticipant[]
  messages     ChatMessage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ChatParticipant {
  id Int @id @default(autoincrement())

  roomId Int
  userId Int

  room ChatRoom @relation(fields: [roomId], references: [id])
  user User     @relation(fields: [userId], references: [id])

  lastReadAt DateTime?

  @@unique([roomId, userId])
}

model ChatMessage {
  id Int @id @default(autoincrement())

  roomId   Int
  senderId Int

  text String

  room   ChatRoom @relation(fields: [roomId], references: [id])
  sender User     @relation("ChatMessageSender", fields: [senderId], references: [id])

  createdAt DateTime @default(now())
}
